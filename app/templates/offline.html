{% extends 'base.html' %}

{% block title %}{{ _('Офлайн') }}{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center bg-background">
    <div class="max-w-md mx-auto text-center">
        <div class="mb-8">
            <!-- Offline Icon -->
            <div class="mx-auto w-24 h-24 bg-muted rounded-full flex items-center justify-center mb-6">
                <svg class="w-12 h-12 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-12.728 12.728m0-12.728l12.728 12.728M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2z"></path>
                </svg>
            </div>
            
            <h1 class="text-3xl font-bold text-foreground mb-4">{{ _('Офлайн байна') }}</h1>
            <p class="text-lg text-muted-foreground mb-6">
                {{ _('Интернет холболт байхгүй байна. Холболт сэргэхэд хүлээнэ үү.') }}
            </p>
        </div>

        <!-- Connection Status -->
        <div class="mb-8">
            <div id="connection-status" class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium">
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd"></path>
                    <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"></path>
                </svg>
                {{ _('Офлайн') }}
            </div>
        </div>

        <!-- Actions -->
        <div class="space-y-4">
            <button onclick="window.location.reload()" class="w-full bg-primary text-primary-foreground px-6 py-3 rounded-lg font-medium hover:bg-primary/90 transition-colors">
                {{ _('Дахин оролдох') }}
            </button>
            
            <button onclick="window.history.back()" class="w-full bg-secondary text-secondary-foreground px-6 py-3 rounded-lg font-medium hover:bg-secondary/90 transition-colors">
                {{ _('Буцах') }}
            </button>
        </div>

        <!-- Cached Content Info -->
        <div class="mt-8 p-4 bg-muted rounded-lg">
            <h3 class="font-medium text-foreground mb-2">{{ _('Кэшдсэн контент') }}</h3>
            <p class="text-sm text-muted-foreground">
                {{ _('Зарим хуудас офлайн үед харагдах боломжтой. Холболт сэргэхэд бүх функц ажиллах болно.') }}
            </p>
        </div>

        <!-- PWA Install Prompt -->
        <div id="pwa-install-prompt" class="mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg hidden">
            <h3 class="font-medium text-blue-900 dark:text-blue-100 mb-2">{{ _('Апп суулгах') }}</h3>
            <p class="text-sm text-blue-700 dark:text-blue-300 mb-3">
                {{ _('Апп суулгаснаар офлайн үед ч ашиглах боломжтой.') }}
            </p>
            <button id="install-app-btn" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 transition-colors">
                {{ _('Суулгах') }}
            </button>
        </div>
    </div>
</div>

<script>
// Connection status update
function updateConnectionStatus() {
    const status = document.getElementById('connection-status');
    if (navigator.onLine) {
        status.innerHTML = `
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
            </svg>
            Онлайн
        `;
        status.className = 'inline-flex items-center px-4 py-2 rounded-full text-sm font-medium text-green-600 bg-green-100';
        
        // Redirect to home when online
        setTimeout(() => {
            window.location.href = '/';
        }, 2000);
    } else {
        status.innerHTML = `
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18.364 5.636l-12.728 12.728m0-12.728l12.728 12.728M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2z" clip-rule="evenodd"></path>
            </svg>
            Офлайн
        `;
        status.className = 'inline-flex items-center px-4 py-2 rounded-full text-sm font-medium text-red-600 bg-red-100';
    }
}

// Listen for online/offline events
window.addEventListener('online', updateConnectionStatus);
window.addEventListener('offline', updateConnectionStatus);

// Initial status check
updateConnectionStatus();

// PWA install prompt
let deferredPrompt;
const installPrompt = document.getElementById('pwa-install-prompt');
const installBtn = document.getElementById('install-app-btn');

window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installPrompt.classList.remove('hidden');
});

installBtn.addEventListener('click', async () => {
    if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
            installPrompt.classList.add('hidden');
        }
        deferredPrompt = null;
    }
});
</script>
{% endblock %}
